<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Users - Kings College School</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { background: #d4edda; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; margin: 10px 0; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; padding: 15px; margin: 10px 0; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 10px 0; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .create-btn { background: #28a745; }
        .create-btn:hover { background: #1e7e34; }
        .user-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
        }
        .user-role {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        .user-email {
            color: #6c757d;
            font-family: monospace;
        }
        .manual-steps {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .manual-steps ol {
            margin-left: 20px;
        }
        .manual-steps li {
            margin: 10px 0;
        }
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            color: #e83e8c;
        }
    </style>
</head>
<body>
    <h1>👥 User Creation Tool - Kings College School</h1>

    <div class="section">
        <div class="warning">
            <h3>⚠️ Important Notice</h3>
            <p><strong>Automatic user creation requires admin privileges and may not work with the anon key.</strong></p>
            <p>If the automatic creation fails, follow the manual steps below to create users in your Supabase dashboard.</p>
        </div>
    </div>

    <div class="section">
        <h3>🤖 Automatic User Creation</h3>
        <p>Click the buttons below to attempt automatic user creation:</p>
        <div id="autoCreateResults"></div>
        
        <div class="user-card">
            <div class="user-role">👑 Super Admin</div>
            <div class="user-email">admin@gmail.com / admin123</div>
            <button class="create-btn" onclick="createUser('admin@gmail.com', 'admin123', 'admin')">Create Admin</button>
        </div>
        
        <div class="user-card">
            <div class="user-role">🛡️ Security Guard</div>
            <div class="user-email">security@gmail.com / security123</div>
            <button class="create-btn" onclick="createUser('security@gmail.com', 'security123', 'security')">Create Security</button>
        </div>
        
        <div class="user-card">
            <div class="user-role">👀 Monitor</div>
            <div class="user-email">monitor@gmail.com / monitor123</div>
            <button class="create-btn" onclick="createUser('monitor@gmail.com', 'monitor123', 'monitor')">Create Monitor</button>
        </div>
        
        <div class="user-card">
            <div class="user-role">👨‍👩‍👧‍👦 Parent</div>
            <div class="user-email">parent@gmail.com / parent123</div>
            <button class="create-btn" onclick="createUser('parent@gmail.com', 'parent123', 'parent')">Create Parent</button>
        </div>
    </div>

    <div class="section manual-steps">
        <h3>📝 Manual User Creation Steps</h3>
        <p>If automatic creation doesn't work, follow these steps in your Supabase dashboard:</p>
        
        <ol>
            <li>Go to your <strong>Supabase Dashboard</strong>: <a href="https://supabase.com/dashboard" target="_blank">https://supabase.com/dashboard</a></li>
            <li>Select your project: <strong>Kings College School Pickup</strong></li>
            <li>Navigate to <strong>Authentication</strong> → <strong>Users</strong></li>
            <li>Click <strong>"Create a new user"</strong></li>
            <li>For each user, enter the following details:</li>
        </ol>

        <h4>🔹 Admin User:</h4>
        <ul>
            <li><strong>Email:</strong> <code>admin@gmail.com</code></li>
            <li><strong>Password:</strong> <code>admin123</code></li>
            <li><strong>Email Confirm:</strong> ✅ Check this box</li>
            <li><strong>User Metadata:</strong> <code>{"role": "admin"}</code></li>
        </ul>

        <h4>🔹 Security User:</h4>
        <ul>
            <li><strong>Email:</strong> <code>security@gmail.com</code></li>
            <li><strong>Password:</strong> <code>security123</code></li>
            <li><strong>Email Confirm:</strong> ✅ Check this box</li>
            <li><strong>User Metadata:</strong> <code>{"role": "security"}</code></li>
        </ul>

        <h4>🔹 Monitor User:</h4>
        <ul>
            <li><strong>Email:</strong> <code>monitor@gmail.com</code></li>
            <li><strong>Password:</strong> <code>monitor123</code></li>
            <li><strong>Email Confirm:</strong> ✅ Check this box</li>
            <li><strong>User Metadata:</strong> <code>{"role": "monitor"}</code></li>
        </ul>

        <h4>🔹 Parent User:</h4>
        <ul>
            <li><strong>Email:</strong> <code>parent@gmail.com</code></li>
            <li><strong>Password:</strong> <code>parent123</code></li>
            <li><strong>Email Confirm:</strong> ✅ Check this box</li>
            <li><strong>User Metadata:</strong> <code>{"role": "parent"}</code></li>
        </ul>

        <div class="info">
            <h4>💡 Important Notes:</h4>
            <ul>
                <li><strong>Email Confirm</strong> must be checked to avoid confirmation email issues</li>
                <li><strong>User Metadata</strong> is crucial for role-based access control</li>
                <li>The JSON format for metadata must be exact: <code>{"role": "admin"}</code></li>
                <li>After creating users, test login with the debug tool: <a href="debug-supabase.html" target="_blank">debug-supabase.html</a></li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h3>🔗 Quick Links</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <a href="https://supabase.com/dashboard" target="_blank">
                <button>🔗 Supabase Dashboard</button>
            </a>
            <a href="debug-supabase.html" target="_blank">
                <button>🧪 Debug Tool</button>
            </a>
            <a href="login-supabase.html" target="_blank">
                <button>🏠 Login Page</button>
            </a>
        </div>
    </div>

    <!-- Load Supabase configuration -->
    <script src="supabase-config.js"></script>
    
    <script>
        async function createUser(email, password, role) {
            const resultsDiv = document.getElementById('autoCreateResults');
            
            try {
                // This likely won't work with anon key, but let's try
                const { data, error } = await supabase.auth.admin.createUser({
                    email: email,
                    password: password,
                    email_confirm: true,
                    user_metadata: {
                        role: role
                    }
                });

                if (error) {
                    console.error('Create user error:', error);
                    resultsDiv.innerHTML += `
                        <div class="error">
                            ❌ Failed to create <strong>${email}</strong>: ${error.message}<br>
                            <small>This is expected with anon key. Please use manual creation steps above.</small>
                        </div>
                    `;
                    return;
                }

                resultsDiv.innerHTML += `
                    <div class="success">
                        ✅ Successfully created <strong>${email}</strong> with role <strong>${role}</strong>
                    </div>
                `;

            } catch (error) {
                console.error('Create user exception:', error);
                resultsDiv.innerHTML += `
                    <div class="error">
                        ❌ Network error creating <strong>${email}</strong>: ${error.message}<br>
                        <small>Please use the manual creation steps above.</small>
                    </div>
                `;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('User creation tool loaded');
        });
    </script>
</body>
</html> 